
This docker-compose permits to run:
 - a [cachet ](https://cachethq.io/) instance to display component status and metrics
 - the cachet plugin [cachet-url-monitor](https://github.com/mtakaki/cachet-url-monitor)
to automatically check components and update status and metrics


 
 Install
 =======

Requirements
------------

 - git
 - docker
 - docker-compose
 
 

First time
----------

1. Update submodule for cachet and monitor

       git submodule init
       git submodule update

2. Build the docker-compose:

       docker-compose build

3. Launch cachet (this should not work):

       docker-compose up cachet

4. Get the APP_KEY and add it in [.env](.env) file
5. Re-launch Cachet (in detached mode this time):

       docker-compose up -d cachet

6. Configuration via the web interface (172.0.3.2:8000). If you don't now for drivers,
use `APC(u)` and `Synchronous`.
7. Connect to Cachet and create components and metrics used by the monitor
8. Get the token of the user (in 172.0.3.2:8000/dashboard/user)
9. Modify the token on the monitor configuration file: [config.yml](cachet-url-monitor-conf/config.yml)
10. Start the monitor:

        docker-compose up -d monitor



Notes
-----

 - The first launch is not easy. The Cachet server need an encryption key
generated by the Cachet container. Also, the monitor need a token (to modify
the status) that is generated once the Cachet server is launched. Once the
APP_KEY and the token is filled, services can be manage normally with the
`docker-compose` commands (`up`, `down`...)
 - One can use, [mtakaki docker containers](https://hub.docker.com/r/mtakaki/cachet-url-monitor).
This repo build the monitor docker, this permits to use it other architecture
(like ARM with a Raspberry Pi).
 - Data is saved in `data` folder.


TODO
====
- [ ] Wait that Cachet API is ready before launching the monitor
- [ ] Fill the BDD with monitor configuration
- [ ] Use `.env` to gather parameters
- [ ] Change the queue system (something else than sync)
